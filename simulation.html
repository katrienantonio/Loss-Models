<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>5 Simulation | Loss Models : a collection of computer labs in R</title>
  <meta name="description" content="Tutorials for the course of Loss Models">
  <meta name="generator" content="bookdown  and GitBook 2.6.7">

  <meta property="og:title" content="5 Simulation | Loss Models : a collection of computer labs in R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Tutorials for the course of Loss Models" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="5 Simulation | Loss Models : a collection of computer labs in R" />
  
  <meta name="twitter:description" content="Tutorials for the course of Loss Models" />
  

<meta name="author" content="Katrien Antonio and Jonas Crevecoeur">


<meta name="date" content="2020-09-09">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="putting-it-all-together-case-study-on-modelling-claim-counts.html">
<link rel="next" href="r-implementation-of-the-assignments-2019-2020.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script>
$(document).ready(function() {

  $chunks = $('.fold');

  $chunks.each(function () {

    // add button to source code chunks
      $(this).prepend("<div class=\"showopt\">Show Solution</div><br style=\"line-height:22px;\"/>");
 
	$child = $(this).children('div');
	$child.each(function(){
		$(this).children('').attr('class', 'folded');
	});
	$(this).children('pre').attr('class', 'folded');
	$(this).children('p').attr('class', 'folded');
   });

  // hide all chunks when document is loaded
  $('.folded').css('display', 'none')

  // function to toggle the visibility
  $('.showopt').click(function() {
    var label = $(this).html();
    if (label.indexOf("Show") >= 0) {
      $(this).html(label.replace("Show", "Hide"));
    } else {
      $(this).html(label.replace("Hide", "Show"));
    }
    	$child = $(this).siblings('div');
	$child.each(function(){
		$(this).children('pre').slideToggle('fast', 'swing');
	});
	$(this).siblings('pre').slideToggle('fast', 'swing');
	$(this).siblings('p').slideToggle('fast', 'swing');
  });
});
</script>


<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Intro</a></li>
<li class="chapter" data-level="2" data-path="data-exploration.html"><a href="data-exploration.html"><i class="fa fa-check"></i><b>2</b> Data exploration</a><ul>
<li class="chapter" data-level="2.1" data-path="data-exploration.html"><a href="data-exploration.html#importing-data-in-r"><i class="fa fa-check"></i><b>2.1</b> Importing data in R</a><ul>
<li class="chapter" data-level="2.1.1" data-path="data-exploration.html"><a href="data-exploration.html#determining-the-file-path"><i class="fa fa-check"></i><b>2.1.1</b> Determining the file path</a></li>
<li class="chapter" data-level="2.1.2" data-path="data-exploration.html"><a href="data-exploration.html#import-a-.txt-file"><i class="fa fa-check"></i><b>2.1.2</b> Import a .txt file</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="data-exploration.html"><a href="data-exploration.html#data-exploration-1"><i class="fa fa-check"></i><b>2.2</b> Data exploration</a><ul>
<li class="chapter" data-level="2.2.1" data-path="data-exploration.html"><a href="data-exploration.html#variable-types"><i class="fa fa-check"></i><b>2.2.1</b> variable types</a></li>
<li class="chapter" data-level="2.2.2" data-path="data-exploration.html"><a href="data-exploration.html#factor-variables"><i class="fa fa-check"></i><b>2.2.2</b> Factor variables</a></li>
<li class="chapter" data-level="2.2.3" data-path="data-exploration.html"><a href="data-exploration.html#numeric-variables"><i class="fa fa-check"></i><b>2.2.3</b> Numeric variables</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="simple-parametric-distributions-for-frequency-and-severity-data.html"><a href="simple-parametric-distributions-for-frequency-and-severity-data.html"><i class="fa fa-check"></i><b>3</b> Simple, parametric distributions for frequency and severity data</a><ul>
<li class="chapter" data-level="3.1" data-path="simple-parametric-distributions-for-frequency-and-severity-data.html"><a href="simple-parametric-distributions-for-frequency-and-severity-data.html#the-exponential-distribution"><i class="fa fa-check"></i><b>3.1</b> The exponential distribution</a><ul>
<li class="chapter" data-level="3.1.1" data-path="simple-parametric-distributions-for-frequency-and-severity-data.html"><a href="simple-parametric-distributions-for-frequency-and-severity-data.html#simulating-data"><i class="fa fa-check"></i><b>3.1.1</b> Simulating data</a></li>
<li class="chapter" data-level="3.1.2" data-path="simple-parametric-distributions-for-frequency-and-severity-data.html"><a href="simple-parametric-distributions-for-frequency-and-severity-data.html#exploratory-analysis"><i class="fa fa-check"></i><b>3.1.2</b> Exploratory analysis</a></li>
<li class="chapter" data-level="3.1.3" data-path="simple-parametric-distributions-for-frequency-and-severity-data.html"><a href="simple-parametric-distributions-for-frequency-and-severity-data.html#data-visualization-with-ggplot"><i class="fa fa-check"></i><b>3.1.3</b> Data visualization with ggplot</a></li>
<li class="chapter" data-level="3.1.4" data-path="simple-parametric-distributions-for-frequency-and-severity-data.html"><a href="simple-parametric-distributions-for-frequency-and-severity-data.html#maximum-likelihood-estimation-mle"><i class="fa fa-check"></i><b>3.1.4</b> Maximum Likelihood Estimation (MLE)</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="simple-parametric-distributions-for-frequency-and-severity-data.html"><a href="simple-parametric-distributions-for-frequency-and-severity-data.html#discrete-distributions"><i class="fa fa-check"></i><b>3.2</b> Discrete distributions</a><ul>
<li class="chapter" data-level="3.2.1" data-path="simple-parametric-distributions-for-frequency-and-severity-data.html"><a href="simple-parametric-distributions-for-frequency-and-severity-data.html#simulating-the-data"><i class="fa fa-check"></i><b>3.2.1</b> Simulating the data</a></li>
<li class="chapter" data-level="3.2.2" data-path="simple-parametric-distributions-for-frequency-and-severity-data.html"><a href="simple-parametric-distributions-for-frequency-and-severity-data.html#exploratory-analysis-1"><i class="fa fa-check"></i><b>3.2.2</b> Exploratory analysis</a></li>
<li class="chapter" data-level="3.2.3" data-path="simple-parametric-distributions-for-frequency-and-severity-data.html"><a href="simple-parametric-distributions-for-frequency-and-severity-data.html#maximum-likelihood-estimation-mle-1"><i class="fa fa-check"></i><b>3.2.3</b> Maximum Likelihood Estimation (MLE)</a></li>
<li class="chapter" data-level="3.2.4" data-path="simple-parametric-distributions-for-frequency-and-severity-data.html"><a href="simple-parametric-distributions-for-frequency-and-severity-data.html#comparing-fitted-models"><i class="fa fa-check"></i><b>3.2.4</b> Comparing fitted models</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="putting-it-all-together-case-study-on-modelling-claim-counts.html"><a href="putting-it-all-together-case-study-on-modelling-claim-counts.html"><i class="fa fa-check"></i><b>4</b> Putting it all together: case study on modelling claim counts</a><ul>
<li class="chapter" data-level="4.1" data-path="putting-it-all-together-case-study-on-modelling-claim-counts.html"><a href="putting-it-all-together-case-study-on-modelling-claim-counts.html#read-in-data"><i class="fa fa-check"></i><b>4.1</b> Read in data</a><ul>
<li class="chapter" data-level="4.1.1" data-path="putting-it-all-together-case-study-on-modelling-claim-counts.html"><a href="putting-it-all-together-case-study-on-modelling-claim-counts.html#determining-the-file-path-1"><i class="fa fa-check"></i><b>4.1.1</b> Determining the file path</a></li>
<li class="chapter" data-level="4.1.2" data-path="putting-it-all-together-case-study-on-modelling-claim-counts.html"><a href="putting-it-all-together-case-study-on-modelling-claim-counts.html#importing-a-.txt-file"><i class="fa fa-check"></i><b>4.1.2</b> Importing a .txt file</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="putting-it-all-together-case-study-on-modelling-claim-counts.html"><a href="putting-it-all-together-case-study-on-modelling-claim-counts.html#exploratory-analysis-2"><i class="fa fa-check"></i><b>4.2</b> Exploratory analysis</a><ul>
<li class="chapter" data-level="4.2.1" data-path="putting-it-all-together-case-study-on-modelling-claim-counts.html"><a href="putting-it-all-together-case-study-on-modelling-claim-counts.html#summary-statistics-disregarding-exposure"><i class="fa fa-check"></i><b>4.2.1</b> Summary statistics disregarding exposure</a></li>
<li class="chapter" data-level="4.2.2" data-path="putting-it-all-together-case-study-on-modelling-claim-counts.html"><a href="putting-it-all-together-case-study-on-modelling-claim-counts.html#summary-statistics-taking-into-account-exposure"><i class="fa fa-check"></i><b>4.2.2</b> Summary statistics taking into account exposure</a></li>
<li class="chapter" data-level="4.2.3" data-path="putting-it-all-together-case-study-on-modelling-claim-counts.html"><a href="putting-it-all-together-case-study-on-modelling-claim-counts.html#empirical-probability-distribution"><i class="fa fa-check"></i><b>4.2.3</b> Empirical probability distribution</a></li>
<li class="chapter" data-level="4.2.4" data-path="putting-it-all-together-case-study-on-modelling-claim-counts.html"><a href="putting-it-all-together-case-study-on-modelling-claim-counts.html#the-a-b-0-class-of-distributions"><i class="fa fa-check"></i><b>4.2.4</b> The (a, b, 0) class of distributions</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="putting-it-all-together-case-study-on-modelling-claim-counts.html"><a href="putting-it-all-together-case-study-on-modelling-claim-counts.html#fitting-count-distributions"><i class="fa fa-check"></i><b>4.3</b> Fitting count distributions</a><ul>
<li class="chapter" data-level="4.3.1" data-path="putting-it-all-together-case-study-on-modelling-claim-counts.html"><a href="putting-it-all-together-case-study-on-modelling-claim-counts.html#poisson"><i class="fa fa-check"></i><b>4.3.1</b> Poisson</a></li>
<li class="chapter" data-level="4.3.2" data-path="putting-it-all-together-case-study-on-modelling-claim-counts.html"><a href="putting-it-all-together-case-study-on-modelling-claim-counts.html#negative-binomial-1"><i class="fa fa-check"></i><b>4.3.2</b> Negative binomial</a></li>
<li class="chapter" data-level="4.3.3" data-path="putting-it-all-together-case-study-on-modelling-claim-counts.html"><a href="putting-it-all-together-case-study-on-modelling-claim-counts.html#modified-poisson-distributions"><i class="fa fa-check"></i><b>4.3.3</b> Modified Poisson distributions</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="putting-it-all-together-case-study-on-modelling-claim-counts.html"><a href="putting-it-all-together-case-study-on-modelling-claim-counts.html#aic-1"><i class="fa fa-check"></i><b>4.4</b> AIC</a></li>
<li class="chapter" data-level="4.5" data-path="putting-it-all-together-case-study-on-modelling-claim-counts.html"><a href="putting-it-all-together-case-study-on-modelling-claim-counts.html#replicating-data-sets"><i class="fa fa-check"></i><b>4.5</b> Replicating data sets</a><ul>
<li class="chapter" data-level="4.5.1" data-path="putting-it-all-together-case-study-on-modelling-claim-counts.html"><a href="putting-it-all-together-case-study-on-modelling-claim-counts.html#poisson-1"><i class="fa fa-check"></i><b>4.5.1</b> Poisson</a></li>
<li class="chapter" data-level="4.5.2" data-path="putting-it-all-together-case-study-on-modelling-claim-counts.html"><a href="putting-it-all-together-case-study-on-modelling-claim-counts.html#nb"><i class="fa fa-check"></i><b>4.5.2</b> NB</a></li>
<li class="chapter" data-level="4.5.3" data-path="putting-it-all-together-case-study-on-modelling-claim-counts.html"><a href="putting-it-all-together-case-study-on-modelling-claim-counts.html#zip"><i class="fa fa-check"></i><b>4.5.3</b> ZIP</a></li>
<li class="chapter" data-level="4.5.4" data-path="putting-it-all-together-case-study-on-modelling-claim-counts.html"><a href="putting-it-all-together-case-study-on-modelling-claim-counts.html#hurdle-poisson-1"><i class="fa fa-check"></i><b>4.5.4</b> Hurdle Poisson</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="putting-it-all-together-case-study-on-modelling-claim-counts.html"><a href="putting-it-all-together-case-study-on-modelling-claim-counts.html#mean-and-variance-of-the-estimated-zip-nb-hurdle-poisson"><i class="fa fa-check"></i><b>4.6</b> Mean and variance of the estimated ZIP, NB, Hurdle Poisson</a><ul>
<li class="chapter" data-level="4.6.1" data-path="putting-it-all-together-case-study-on-modelling-claim-counts.html"><a href="putting-it-all-together-case-study-on-modelling-claim-counts.html#poisson-2"><i class="fa fa-check"></i><b>4.6.1</b> Poisson</a></li>
<li class="chapter" data-level="4.6.2" data-path="putting-it-all-together-case-study-on-modelling-claim-counts.html"><a href="putting-it-all-together-case-study-on-modelling-claim-counts.html#nb-1"><i class="fa fa-check"></i><b>4.6.2</b> NB</a></li>
<li class="chapter" data-level="4.6.3" data-path="putting-it-all-together-case-study-on-modelling-claim-counts.html"><a href="putting-it-all-together-case-study-on-modelling-claim-counts.html#zip-1"><i class="fa fa-check"></i><b>4.6.3</b> ZIP</a></li>
<li class="chapter" data-level="4.6.4" data-path="putting-it-all-together-case-study-on-modelling-claim-counts.html"><a href="putting-it-all-together-case-study-on-modelling-claim-counts.html#hurdle-poisson-2"><i class="fa fa-check"></i><b>4.6.4</b> Hurdle Poisson</a></li>
<li class="chapter" data-level="4.6.5" data-path="putting-it-all-together-case-study-on-modelling-claim-counts.html"><a href="putting-it-all-together-case-study-on-modelling-claim-counts.html#comparison-with-empirical-mean-and-variance"><i class="fa fa-check"></i><b>4.6.5</b> Comparison with empirical mean and variance</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="putting-it-all-together-case-study-on-modelling-claim-counts.html"><a href="putting-it-all-together-case-study-on-modelling-claim-counts.html#conclusion"><i class="fa fa-check"></i><b>4.7</b> Conclusion</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="simulation.html"><a href="simulation.html"><i class="fa fa-check"></i><b>5</b> Simulation</a><ul>
<li class="chapter" data-level="5.1" data-path="simulation.html"><a href="simulation.html#severity"><i class="fa fa-check"></i><b>5.1</b> Severity</a><ul>
<li class="chapter" data-level="5.1.1" data-path="simulation.html"><a href="simulation.html#probability-integral-transform"><i class="fa fa-check"></i><b>5.1.1</b> Probability integral transform</a></li>
<li class="chapter" data-level="5.1.2" data-path="simulation.html"><a href="simulation.html#visualization"><i class="fa fa-check"></i><b>5.1.2</b> Visualization</a></li>
<li class="chapter" data-level="5.1.3" data-path="simulation.html"><a href="simulation.html#expected-loss-with-a-deductible"><i class="fa fa-check"></i><b>5.1.3</b> Expected loss with a deductible</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="simulation.html"><a href="simulation.html#aggregate-loss"><i class="fa fa-check"></i><b>5.2</b> Aggregate loss</a></li>
<li class="chapter" data-level="5.3" data-path="simulation.html"><a href="simulation.html#simulating-future-life-times-of-newborns"><i class="fa fa-check"></i><b>5.3</b> Simulating future life times of newborns</a><ul>
<li class="chapter" data-level="5.3.1" data-path="simulation.html"><a href="simulation.html#importing-the-data"><i class="fa fa-check"></i><b>5.3.1</b> Importing the data</a></li>
<li class="chapter" data-level="5.3.2" data-path="simulation.html"><a href="simulation.html#simulate-the-whole-life-time"><i class="fa fa-check"></i><b>5.3.2</b> Simulate the whole life time</a></li>
<li class="chapter" data-level="5.3.3" data-path="simulation.html"><a href="simulation.html#simulate-the-future-lifetime"><i class="fa fa-check"></i><b>5.3.3</b> Simulate the future lifetime</a></li>
<li class="chapter" data-level="5.3.4" data-path="simulation.html"><a href="simulation.html#visualize-the-data"><i class="fa fa-check"></i><b>5.3.4</b> Visualize the data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="r-implementation-of-the-assignments-2019-2020.html"><a href="r-implementation-of-the-assignments-2019-2020.html"><i class="fa fa-check"></i><b>6</b> R implementation of the assignments 2019-2020</a><ul>
<li class="chapter" data-level="6.1" data-path="r-implementation-of-the-assignments-2019-2020.html"><a href="r-implementation-of-the-assignments-2019-2020.html#assignment-1"><i class="fa fa-check"></i><b>6.1</b> Assignment 1</a><ul>
<li class="chapter" data-level="6.1.1" data-path="r-implementation-of-the-assignments-2019-2020.html"><a href="r-implementation-of-the-assignments-2019-2020.html#exercise-1"><i class="fa fa-check"></i><b>6.1.1</b> Exercise 1</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="r-implementation-of-the-assignments-2019-2020.html"><a href="r-implementation-of-the-assignments-2019-2020.html#assignment-2"><i class="fa fa-check"></i><b>6.2</b> Assignment 2</a><ul>
<li class="chapter" data-level="6.2.1" data-path="r-implementation-of-the-assignments-2019-2020.html"><a href="r-implementation-of-the-assignments-2019-2020.html#exercise-2"><i class="fa fa-check"></i><b>6.2.1</b> Exercise 2</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Loss Models : a collection of computer labs in R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="simulation" class="section level1">
<h1><span class="header-section-number">5</span> Simulation</h1>
<p>You will now focus on simulation methods. You will first learn how to draw simulations from a specified, parametric distribution using the Probability Integral Transform (PIT) technique. Then, you will apply your insights to a real-life example where the future lifetimes of newborns are simulated using a recent life table published by Statistics Belgium.</p>
<div id="severity" class="section level2">
<h2><span class="header-section-number">5.1</span> Severity</h2>
<p>In this exercise you will simulate <span class="math inline">\(100\)</span> losses <span class="math inline">\(X\)</span> from a Pareto distribution with distribution function</p>
<p><span class="math display">\[ F_X(x) = 1 - \left( \frac{1000}{1000 + x}\right)^3.\]</span></p>
<p>You will use these simulated observations to calculate the expected loss with a deductible of <span class="math inline">\(300\)</span>, i.e. <span class="math inline">\(E[(X - 300)_+]\)</span>.</p>
<div id="probability-integral-transform" class="section level3">
<h3><span class="header-section-number">5.1.1</span> Probability integral transform</h3>
<p>The probability integral transform (PIT) refers to the following property (see Section 20.1 in the Loss Models book)</p>
<blockquote>
<p>If a random variable <span class="math inline">\(X\)</span> has a continuous distribution with CDF <span class="math inline">\(F_X\)</span>. Then the random variable <span class="math inline">\(Y\)</span> defined as <span class="math inline">\(Y = F_X(X)\)</span> has a uniform distribution.</p>
</blockquote>
<p>A modified version of this property is often used when simulating data</p>
<blockquote>
<p>Given a CDF <span class="math inline">\(F_X\)</span> of a continuous distribution and a uniformly distributed random variable <span class="math inline">\(U\)</span> on <span class="math inline">\([0, 1]\)</span>. Then <span class="math inline">\(F_X\)</span> is the CDF of the random variable <span class="math inline">\(X = F_X^{-1}(U)\)</span>.</p>
</blockquote>
<p>We illustrate this with the exponential distribution, <span class="math display">\[ 
F_Y(y) = \begin{cases} 
1 - \exp(-\lambda \cdot y) &amp; y \geq 0 \\
0 &amp; y &lt; 0
\end{cases}
\]</span> and <span class="math display">\[ 
F_Y^{-1}(z) = -\frac{\log(1-z)}{\lambda}, \quad z \in (0, 1).
\]</span></p>
<p>We simulate <span class="math inline">\(u\)</span> from a uniform distribution on <span class="math inline">\([0, 1]\)</span>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">4</span>)
u &lt;-<span class="st"> </span><span class="kw">runif</span>(<span class="dv">1</span>)</code></pre></div>
<p>When we now apply the inverse cdf on this simulation <span class="math inline">\(u\)</span>, we obtain a simulation from the exponential distribution.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Finverse &lt;-<span class="st"> </span><span class="cf">function</span>(z, lambda) {
  <span class="op">-</span><span class="kw">log</span>(<span class="dv">1</span><span class="op">-</span>z) <span class="op">/</span><span class="st"> </span>lambda
}

lambda &lt;-<span class="st"> </span><span class="dv">1</span>
sim &lt;-<span class="st"> </span><span class="kw">Finverse</span>(u, lambda)

<span class="kw">print</span>(<span class="kw">c</span>(<span class="dt">u =</span> u, <span class="dt">sim =</span> sim))</code></pre></div>
<pre><code>     u    sim 
0.5858 0.8814 </code></pre>
<p><img src="_main_files/figure-html/cdf%20exponential-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>For more information see <a href="https://en.wikipedia.org/wiki/Probability_integral_transform">probability integral transform</a> and <a href="https://en.wikipedia.org/wiki/Inverse_transform_sampling">inverse transform sampling</a>. Because of this property, you can follow the steps below to simulate <span class="math inline">\(n\)</span> independent observations from a distribution with CDF <span class="math inline">\(F_X\)</span>:</p>
<ol style="list-style-type: decimal">
<li>Simulate <span class="math inline">\(n\)</span> indepdendent observations <span class="math inline">\(u_1, \ldots, u_n\)</span> from a uniform distribution (<code>runif</code> in R) on <span class="math inline">\([0, 1]\)</span>;</li>
<li>Calculate <span class="math inline">\(F_X^{-1}\)</span>;</li>
<li><span class="math inline">\(F_X^{-1}(u_1), \ldots, F_X^{-1}(u_n)\)</span> are <span class="math inline">\(n\)</span> independent observations with CDF <span class="math inline">\(F_X\)</span>.</li>
</ol>
<p>Now follow these steps in R and generate <span class="math inline">\(100\)</span> independent observations from a Pareto distribution.</p>
<ol style="list-style-type: decimal">
<li>Create a vector <code>u</code> containing <span class="math inline">\(100\)</span> independent observations from a uniform distribution;</li>
<li>Compute <span class="math inline">\(F_X^{-1}\)</span> on paper and implement <span class="math inline">\(F_X^{-1}\)</span> as a function in R;</li>
<li>Calculate <span class="math inline">\(F_X^{-1}(u)\)</span>.</li>
</ol>
<div class="fold s">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># @1. </span>
n &lt;-<span class="st"> </span><span class="dv">100</span>;
u &lt;-<span class="st"> </span><span class="kw">runif</span>(n, <span class="dv">0</span>, <span class="dv">1</span>)


<span class="co"># @2.</span>
cdf.inverse &lt;-<span class="st"> </span><span class="cf">function</span>(y)
{
  <span class="kw">return</span>(<span class="dv">1000</span> <span class="op">/</span><span class="st"> </span>(<span class="dv">1</span><span class="op">-</span>y)<span class="op">^</span>{<span class="dv">1</span><span class="op">/</span><span class="dv">3</span>} <span class="op">-</span><span class="st"> </span><span class="dv">1000</span>)
}

<span class="co"># @3.</span>
sim &lt;-<span class="st"> </span><span class="kw">cdf.inverse</span>(u)</code></pre></div>
</div>
</div>
<div id="visualization" class="section level3">
<h3><span class="header-section-number">5.1.2</span> Visualization</h3>
<p>You will create the following visualization to compare the actual and empirical CDF.</p>
<p><img src="_main_files/figure-html/simulation_cdf_pareto-1.png" width="576" style="display: block; margin: auto;" /></p>
<ol style="list-style-type: decimal">
<li>Create a function <code>cdf</code> in R with input a vector <span class="math inline">\(x\)</span> and output a vector <span class="math inline">\(F_X(x)\)</span>;</li>
<li>Compute the theoretical cdf in the simulated points and store the result in a vector <span class="math inline">\(y\)</span>;</li>
<li>Load the package <code>ggplot</code>;</li>
<li>Complete the following <code>ggplot</code> command to plot the empiciral and theoretical CDF.</li>
</ol>
<ul>
<li><code>col = &quot;empirical CDF&quot;</code> selects a different color for each line and adds a legend to the figure;</li>
<li><code>scale_colour_manual</code> specifies the colors to be used in in the figure. The first argument specifies the title for the legend;</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  <span class="kw">ggplot</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">stat_ecdf</span>(<span class="kw">aes</span>(???, <span class="dt">col =</span> <span class="st">&quot;empirical CDF&quot;</span>)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(???, ???, <span class="dt">col =</span> <span class="st">&quot;theoretical CDF&quot;</span>)) <span class="op">+</span>
<span class="st">    </span><span class="kw">scale_colour_manual</span>(<span class="st">&quot;legend title&quot;</span>, <span class="dt">values=</span><span class="kw">c</span>(<span class="st">&quot;#99CCFF&quot;</span>,<span class="st">&quot;#e58920&quot;</span>))</code></pre></div>
<ol start="5" style="list-style-type: decimal">
<li><p><a href="https://ggplot2.tidyverse.org/reference/theme.html"><code>theme(...)</code></a> changes many visual aspects of a ggplot figure. Search in the documentation for an option to move the legend to the bottom of the figure.</p></li>
<li><p>Improve your graph by adding options such as <code>theme_bw()</code>, <code>xlab</code>, <code>ylab</code>, <code>ggtitle</code>, â€¦.</p></li>
</ol>
</div>
<div id="expected-loss-with-a-deductible" class="section level3">
<h3><span class="header-section-number">5.1.3</span> Expected loss with a deductible</h3>
<p>Statistical quantities of the distribution can be approximated by means of the simulated data. You will now calculate the expected loss when there is a deductible of <span class="math inline">\(300\)</span> using your simulated data.</p>
<ol style="list-style-type: decimal">
<li><p>Write a function <code>deductible</code> taking as input <code>x</code> (a vector containing the loss amounts) and <code>d</code> (the deductible) and returning a vector <span class="math inline">\(y\)</span> with <span class="math inline">\(y_i = (x_i-d)_+ = \max(x_i-d, 0)\)</span>;</p></li>
<li><p>Test the function <code>deductible</code> that you defined in the previous step. What is the output for <code>dedutible(c(500, 200), 300)</code>. Is your function working as expected? A common mistake in implementing the <code>deductible</code> function is a misunderstanding of the <code>max</code> function in R;</p></li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  <span class="co"># returns the maximum of 1, 3 and 2</span>
  <span class="kw">max</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>), <span class="dv">2</span>)</code></pre></div>
<pre><code>[1] 3</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  <span class="co"># returns a vector containing max(1, 2) and max(3, 2) </span>
  <span class="kw">pmax</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>), <span class="dv">2</span>)</code></pre></div>
<pre><code>[1] 2 3</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Calculate <span class="math inline">\(E(X-300)_+\)</span> for your simulated vector.</li>
</ol>
<div class="fold s">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">deductible &lt;-<span class="st"> </span><span class="cf">function</span>(x, d)
{
  <span class="kw">return</span>(<span class="kw">pmax</span>(x<span class="op">-</span>d, <span class="dv">0</span>))
}

<span class="kw">mean</span>(<span class="kw">deductible</span>(sim, <span class="dv">300</span>))</code></pre></div>
<pre><code>[1] 382.3</code></pre>
</div>
</div>
</div>
<div id="aggregate-loss" class="section level2">
<h2><span class="header-section-number">5.2</span> Aggregate loss</h2>
<p>The number of claims <span class="math inline">\(N\)</span> on an insurance contract is Poisson distributed with mean <span class="math inline">\(2\)</span>. The claim sizes <span class="math inline">\(X\)</span> are independently distributed with CDF</p>
<p><span class="math display">\[ 
  F_X(x) = 
  \begin{cases}
    0 &amp; x \leq 0 \\
    x^2 &amp; 0 &lt; x \leq 1 \\
    1 &amp; x &gt; 1
  \end{cases}.
\]</span> The insurer wants to investigate the difference between imposing an aggregate or an ordinary deductible for this contract. You will calculate (using 10000 simulations) the expected loss by contract for both an aggregate deductible of <span class="math inline">\(0.2\)</span> and an ordinary deductible of <span class="math inline">\(0.2\)</span>.</p>
<ol style="list-style-type: decimal">
<li>Simulate <span class="math inline">\(10000\)</span> observations for the number of claims <span class="math inline">\(N\)</span>. (Hint <code>rpois</code>);</li>
<li>Use what you learnt in the previous exercise and create a function <code>simulate</code>, which returns <code>n</code> simulations of the claim size distribution <span class="math inline">\(F_X\)</span>.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  simulate &lt;-<span class="st"> </span><span class="cf">function</span>(n)
  {
    ??
  }</code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Complete the following for-loop to simulate 10000 aggregate losses when there is no deductible</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">n &lt;-<span class="st"> </span><span class="dv">10000</span>
nclaim &lt;-<span class="st"> </span><span class="co"># Result from 1.</span>

<span class="co"># create an empty vector to store the aggregated loss</span>
aggregated.loss &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">0</span>, n)
  
<span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>n)
{
  <span class="co"># the claims for the i-th contract</span>
  claims &lt;-<span class="st"> </span><span class="kw">simulate</span>(nclaim[i])
  
  <span class="co"># without deductible the aggregated loss is the sum of the individual claims</span>
  aggregated.loss[i] &lt;-<span class="st"> </span><span class="kw">sum</span>(claims)
}
  
<span class="co"># Calculate the expected loss per policy, when there is no deductible</span>
<span class="kw">mean</span>(aggregated.loss)</code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Adapt the code in 3. to calculate the expected loss per policy when there is an aggregate deductible of <span class="math inline">\(0.2\)</span>;</li>
<li>Adapt the code in 3. to calculate the expected loss per policy when there is an ordinary deductible of <span class="math inline">\(0.2\)</span>.</li>
</ol>
<div class="fold s">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># @1</span>
n &lt;-<span class="st"> </span><span class="dv">10000</span>
nclaim &lt;-<span class="st"> </span><span class="kw">rpois</span>(n, <span class="dt">lambda =</span> <span class="dv">2</span>)

<span class="co"># @2</span>
cdf.inverse &lt;-<span class="st"> </span><span class="cf">function</span>(x)
{
  <span class="kw">return</span>(<span class="kw">sqrt</span>(x))
}

simulate &lt;-<span class="st"> </span><span class="cf">function</span>(n)
{
  u &lt;-<span class="st"> </span><span class="kw">runif</span>(n)
  <span class="kw">return</span>(<span class="kw">cdf.inverse</span>(u));
}

<span class="co"># @3</span>
n &lt;-<span class="st"> </span><span class="dv">10000</span>
nclaim &lt;-<span class="st"> </span><span class="kw">rpois</span>(n, <span class="dt">lambda =</span> <span class="dv">2</span>)

<span class="co"># create an empty vector to store the aggregated loss</span>
aggregated.loss &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">0</span>, n)
  
<span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>n)
{
  <span class="co"># the claims for the i-th contract</span>
  claims &lt;-<span class="st"> </span><span class="kw">simulate</span>(nclaim[i])
  
  <span class="co"># without deductible the aggregated loss is the sum of the individual claims</span>
  aggregated.loss[i] &lt;-<span class="st"> </span><span class="kw">sum</span>(claims)
}
  
<span class="co"># Calculate the expected loss per policy, when there is no deductible</span>
<span class="kw">mean</span>(aggregated.loss)</code></pre></div>
<pre><code>[1] 1.328</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># @4</span>
n &lt;-<span class="st"> </span><span class="dv">10000</span>
nclaim &lt;-<span class="st"> </span><span class="kw">rpois</span>(n, <span class="dt">lambda =</span> <span class="dv">2</span>)

<span class="co"># create an empty vector to store the aggregated loss</span>
aggregated.loss &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">0</span>, n)
  
<span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>n)
{
  <span class="co"># the claims for the i-th contract</span>
  claims &lt;-<span class="st"> </span><span class="kw">simulate</span>(nclaim[i])
  
  <span class="co"># without deductible the aggregated loss is the sum of the individual claims</span>
  aggregated.loss[i] &lt;-<span class="st"> </span><span class="kw">sum</span>(claims)
}
  
<span class="co"># Calculate the expected loss per policy, when there is no deductible</span>
<span class="kw">mean</span>(<span class="kw">pmax</span>(aggregated.loss <span class="op">-</span><span class="st"> </span><span class="fl">0.2</span>, <span class="dv">0</span>))</code></pre></div>
<pre><code>[1] 1.16</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># @5</span>
n &lt;-<span class="st"> </span><span class="dv">10000</span>
nclaim &lt;-<span class="st"> </span><span class="kw">rpois</span>(n, <span class="dt">lambda =</span> <span class="dv">2</span>)

<span class="co"># create an empty vector to store the aggregated loss</span>
aggregated.loss &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">0</span>, n)
  
<span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>n)
{
  <span class="co"># the claims for the i-th contract</span>
  claims &lt;-<span class="st"> </span><span class="kw">pmax</span>(<span class="kw">simulate</span>(nclaim[i]) <span class="op">-</span><span class="st"> </span><span class="fl">0.2</span>, <span class="dv">0</span>)
  
  <span class="co"># without deductible the aggregated loss is the sum of the individual claims</span>
  aggregated.loss[i] &lt;-<span class="st"> </span><span class="kw">sum</span>(claims)
}
  
<span class="co"># Calculate the expected loss per policy, when there is no deductible</span>
<span class="kw">mean</span>(aggregated.loss)</code></pre></div>
<pre><code>[1] 0.9413</code></pre>
</div>
</div>
<div id="simulating-future-life-times-of-newborns" class="section level2">
<h2><span class="header-section-number">5.3</span> Simulating future life times of newborns</h2>
<p>In this exercise you simulate the age at death for 10000 newborns based on the lifetable for Belgian males in 2017 published by <a href="https://statbel.fgov.be/en/themes/population/life-expectancy-and-life-tables">stabel</a>. You will use these simulations to construct a histogram as well as a density plot of the lifetime distribution.</p>
<div id="importing-the-data" class="section level3">
<h3><span class="header-section-number">5.3.1</span> Importing the data</h3>
<p>Download and save the file <a href="data/lifetableMaleBE2017.csv">lifetableMaleBE2017.csv</a> on your local drive. This file contains the columns <code>age</code> and <code>q</code>, where</p>
<p><span class="math display">\[ q_{age} = P(T_0 \in (age, age + 1] \mid T_0 &gt; age),\]</span> with <span class="math inline">\(T_0\)</span> the random variable describing the lifetime of a newborn. Hence, <span class="math inline">\(q_{age}\)</span> is the one year probability of dying at age <span class="math inline">\(\text{age}\)</span>.</p>
<ol style="list-style-type: decimal">
<li>Save the file <a href="data/lifetableMaleBE2017.csv">lifetableMaleBE2017.csv</a> on your local drive;</li>
<li>Use <a href="https://stat.ethz.ch/R-manual/R-devel/library/utils/html/read.table.html"><code>read.table</code></a> to load the data into R. Semicolons <code>;</code> separate the data and the first line of the data contains the variable names;</li>
<li>Create variables <code>age</code> and <code>q</code> which store the corresponding variables from the dataset.</li>
</ol>
<div class="fold s">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">setwd</span>(<span class="st">&#39;C:/Users/u0110176/Dropbox/Verzekeringen niet-leven/Bookdown/&#39;</span>)
data &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="st">&#39;data/lifetableMaleBE2017.csv&#39;</span>, <span class="dt">sep =</span> <span class="st">&#39;;&#39;</span>, <span class="dt">header =</span> <span class="ot">TRUE</span>)

age &lt;-<span class="st"> </span>data<span class="op">$</span>age;
q &lt;-<span class="st"> </span>data<span class="op">$</span>q;</code></pre></div>
</div>
</div>
<div id="simulate-the-whole-life-time" class="section level3">
<h3><span class="header-section-number">5.3.2</span> Simulate the whole life time</h3>
<p>First, you simulate the whole remaining lifetime <span class="math inline">\(K_0 = \lfloor{T_0} \rfloor\)</span> for a newborn. The whole lifetime is the integer age at which the newborn dies. You calculate the cdf of <span class="math inline">\(K_0\)</span> at integer ages <span class="math inline">\(x\)</span> as follows</p>
<span class="math display">\[\begin{align*}
  P(K_0 \leq x) &amp;= P(T_0 &lt; x+1) \\
              &amp;= 1 - P(T_0 \geq x+1) \\
              &amp;= 1 - P(T_0 \geq x + 1 \mid T_0 &gt; x) \cdot P(T_0 &gt; x) \\
              &amp;= 1 - (1-q_{x}) \cdot P(T_0 &gt; x) \\
              &amp;= 1 - \prod_{i=0}^{x} (1-q_{x-i}).
\end{align*}\]</span>
<p>or you reason as follows</p>
<span class="math display">\[\begin{align*}
  P(K_0 \leq x) &amp;= P(K_0=0)+P(K_0=1)+ \ldots +P(K_0=x) \\
              &amp;= q_0+(1-q_0)\cdot q_1 + (1-q_0)\cdot(1-q_1)\cdot q_2 + \ldots + (1-q_0)\cdot(1-q_1)\ldots (1-q_{x-1})\cdot q_x \\
              &amp;= 1 - \prod_{i=0}^{x} (1-q_{x-i}).
\end{align*}\]</span>
<!--We calculate the distribution of $K$

\begin{align*}
  P(K = x) &= P(T \in (x, x+1]) \\
           &= P(T \in (x, x+1] \mid T > x) \cdot P(T > x) \\
           &= q_x \cdot P(T > x).
\end{align*}

The probability of surviving beyond age $x$ is given by

\begin{align*}
  P(T > x) &= P(T > x \mid T > x-1) \cdot P(T > x-1) \\
           &= (1-q_{x-1}) \cdot P(T > x-1) \\
           &= (1-q_{x-1}) \cdot (1-q_{x-2}) \cdot P(T > x-2)  \\
           &= \prod_{i=1}^{x} (1-q_{x-i}).
\end{align*}-->
<ol style="list-style-type: decimal">
<li>Create a vector <code>cdf</code> in R with <span class="math inline">\(cdf[x+1] = P(K_0 \leq x)\)</span> for <span class="math inline">\(x \in 0, \ldots, 105\)</span>. Hint: <code>cumprod</code> in R;</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  <span class="kw">cumprod</span>(<span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">7</span>))</code></pre></div>
<pre><code>[1]   2   6  30 210</code></pre>
<p>The Figure below shows the CDF of the whole lifetime <span class="math inline">\(K_0\)</span> for a newborn. Since <span class="math inline">\(K_0\)</span> is a discrete random variable this CDF is a step function.</p>
<p><img src="_main_files/figure-html/simulation_cdf_whole_lifetime-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>The following Theorem presents a strategy for simulating from a discrete distribution given its CDF.</p>
<blockquote>
<p>Given a CDF <span class="math inline">\(F_X\)</span> of a discrete distribution with possible outcomes <span class="math inline">\(x_1, \ldots, x_n\)</span> and a uniformly distributed random variable <span class="math inline">\(U\)</span> on <span class="math inline">\([0, 1]\)</span>. Then <span class="math inline">\(F_X\)</span> is the CDF of the random variable <span class="math inline">\(X = \max_{x_i} \{ F_X(x_i) \leq U \}\)</span>.</p>
</blockquote>
<ol start="2" style="list-style-type: decimal">
<li>Complete the code below to simulate a single observation from <span class="math inline">\(K_0\)</span>. This function performs the following steps:</li>
</ol>
<ul>
<li>Simulate an observation <span class="math inline">\(u\)</span> from a random variable <span class="math inline">\(U \in [0, 1]\)</span>;</li>
<li>Loop over all posible ages <span class="math inline">\(x\)</span> in increasing order;</li>
<li>Find the smallest age <span class="math inline">\(x\)</span> for which <span class="math inline">\(F_{K_0}(x) &gt; u\)</span>;</li>
<li>The previous age <span class="math inline">\(x-1\)</span> is the largest age for which <span class="math inline">\(F_{K_0}(x) \leq u\)</span>. By the theorem above, <span class="math inline">\(x-1\)</span> is a simulation for the whole age.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">simulWholeAge &lt;-<span class="st"> </span><span class="cf">function</span>()
{
  <span class="co"># simulate one observation u from a uniform distribution on [0, 1]</span>
  u &lt;-<span class="st"> </span><span class="kw">runif</span>(<span class="dv">1</span>);
  
  <span class="co"># loop over all posible values F_X(x_i) in increasing order</span>
  <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(cdf))
  {
    <span class="co"># Check F_X(x_i) &gt; U</span>
    <span class="cf">if</span>( ??? )
    {
      <span class="co"># If F_X(x_i) &gt; u, then the previous value x_{i-1} is the largest value for which F_X(x_{i-1}) &lt;= u</span>
      <span class="kw">return</span>( ??? );
    }
  }
}</code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Use <code>simulWholeAge</code> to generate 10000 observations from the distribution of <span class="math inline">\(K_0\)</span>;</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># the number of simulations</span>
nsim &lt;-<span class="st"> </span><span class="dv">10000</span>

<span class="co"># initialise a vector with nsim zeroes.</span>
K &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">0</span>, nsim)

<span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>nsim)
{
  <span class="co"># Simulate the age of death for a single individual;</span>
  K[i] &lt;-<span class="st"> </span>???
}</code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Use <code>ggplot</code> to create a histogram of your simulation for the whole life time. See <a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html"><code>geom_histogram</code></a>.</li>
</ol>
<p><img src="_main_files/figure-html/simulation_histogram_whole_lifetime-1.png" width="576" style="display: block; margin: auto;" /></p>
<div class="fold s">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cdf &lt;-<span class="st"> </span><span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="kw">cumprod</span>(<span class="dv">1</span><span class="op">-</span>q)

nsim &lt;-<span class="st"> </span><span class="dv">10000</span>
K &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">0</span>, nsim)

simulWholeAge &lt;-<span class="st"> </span><span class="cf">function</span>()
{
  u &lt;-<span class="st"> </span><span class="kw">runif</span>(<span class="dv">1</span>);
  
  <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(cdf))
  {
    <span class="cf">if</span>(u <span class="op">&lt;</span><span class="st"> </span>cdf[j])
    {
      <span class="kw">return</span>(j<span class="op">-</span><span class="dv">1</span>);
    }
  }
}

<span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>nsim)
{
  K[i] &lt;-<span class="st"> </span><span class="kw">simulWholeAge</span>();
}


<span class="kw">ggplot</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(K), <span class="dt">col =</span> <span class="st">&quot;#99CCFF&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;#99CCFF&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Histogram lifetime male, Belgium 2017&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">xlab</span>(<span class="st">&#39;age&#39;</span>)</code></pre></div>
<pre><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="_main_files/figure-html/simulattion_whole_lifetime_solution-1.png" width="576" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="simulate-the-future-lifetime" class="section level3">
<h3><span class="header-section-number">5.3.3</span> Simulate the future lifetime</h3>
<p>You will now simulate the exact (instead of integer) remaining lifetime <span class="math inline">\(T_0\)</span> of a newborn. Note that <span class="math inline">\(T_0\)</span> can be written as (explain!) <span class="math inline">\(T_0 = \lfloor T_0 \rfloor + (T_0-\lfloor T_0 \rfloor)\)</span> where <span class="math inline">\(\lfloor T_0 \rfloor \in \mathbb{N}\)</span> and <span class="math inline">\((T_0-\lfloor T_0 \rfloor) \in [0,1)\)</span>. You will need to make an assumption regarding the probability of dying at non-integer ages. You assume a constant force of mortality between integer ages, i.e.</p>
<p><span class="math display">\[ P(T_0 \leq t + x \mid T_0 &gt; x) = 1 - \exp(-\mu_x \cdot t), \quad \text{for} \quad x \in \mathbb{N} \quad \text{and} \quad t \in [0, 1)\]</span> for some intensity <span class="math inline">\(\mu_x\)</span> of dying at age <span class="math inline">\(x\)</span>. More insight behind this assumption will be given in the courses on Life Insurance Mathematics and Advanced Life Insurance Mathematics. The intensity <span class="math inline">\(\mu_x\)</span> can be found by taking <span class="math inline">\(t = 1\)</span> in the above expression,</p>
<p><span class="math display">\[ 1 - \exp(-\mu_x) = P(T_0 \leq 1 + x \mid T_0 &gt; x) = q_x, \]</span> from which</p>
<p><span class="math display">\[ \mu_x = -\log(1-q_x).\]</span></p>
<p>From this you compute the distribution of <span class="math inline">\(T_0 - K_0 \mid K_0 = x\)</span>,</p>
<span class="math display">\[\begin{align}
  P(T_0 - K_0 \leq t \mid K_0 = x)  &amp;= P(T_0 \leq x + t \mid T_0 \geq x,\ T _0\leq x+1) \\
                              &amp;= \frac{P(T_0 \leq x+t \mid T_0 \geq x)}{P(T_0 \leq x+1 \mid T_0 \geq x)} \\
                              &amp;= \frac{1- (1-q_x)^t}{q_x}.
\end{align}\]</span>
<p>In the previous section, you simulated an observation for the whole lifetime <span class="math inline">\(K_0\)</span> of a newborn. You will now simulate a corresponding observation from the distribution of <span class="math inline">\(T_0-K_0 \mid K_0\)</span>. The distribution for <span class="math inline">\(T_0 - K_0 \mid K_0\)</span> is continuous and the classical Probability Integral Transform can be used.</p>
<ol style="list-style-type: decimal">
<li>Show that the inverted CDF of <span class="math inline">\(T_0 - K_0 \mid K_0\)</span> is given by</li>
</ol>
<p><span class="math display">\[
  F^{-1}_{T_0-K_0\mid K_0}(y \mid x) = \frac{\log(1-q_x \cdot y)}{\log(1-q_x)};
\]</span></p>
<ol start="2" style="list-style-type: decimal">
<li><p>Simulate for each observation of <span class="math inline">\(K_0\)</span> a sample from the distribution <span class="math inline">\(T_0-K_0 \mid K_0\)</span>. Verify that the correct value of <span class="math inline">\(q_x\)</span> is used for each sample;</p></li>
<li><p>Add the simulations from <span class="math inline">\(K_0\)</span> and <span class="math inline">\(T_0-K_0 \mid K_0\)</span> to obtain simulations for the remaining lifetime <span class="math inline">\(T_0\)</span> of a newborn.</p></li>
</ol>
<div class="fold s">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># @2</span>
u &lt;-<span class="st"> </span><span class="kw">runif</span>(nsim)
remainder &lt;-<span class="st"> </span><span class="kw">log</span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>q[K<span class="op">+</span><span class="dv">1</span>] <span class="op">*</span><span class="st"> </span>u) <span class="op">/</span><span class="st"> </span><span class="kw">log</span>(<span class="dv">1</span><span class="op">-</span>q[K<span class="op">+</span><span class="dv">1</span>])

sim &lt;-<span class="st"> </span>K <span class="op">+</span><span class="st"> </span>remainder</code></pre></div>
</div>
</div>
<div id="visualize-the-data" class="section level3">
<h3><span class="header-section-number">5.3.4</span> Visualize the data</h3>
<p>Visualize the density of the remaining life time <span class="math inline">\(T_0\)</span> of a newborn with <code>ggplot</code>.</p>
<p><img src="_main_files/figure-html/simulation_density_lifetime-1.png" width="576" style="display: block; margin: auto;" /></p>
<div class="fold s">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_density</span>(<span class="kw">aes</span>(sim), <span class="dt">col =</span> <span class="st">&quot;#99CCFF&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;#99CCFF&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Density lifetime male, Belgium 2017&quot;</span>)</code></pre></div>
<p><img src="_main_files/figure-html/simulation_density_lifetime_solution-1.png" width="576" style="display: block; margin: auto;" /></p>
</div>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="putting-it-all-together-case-study-on-modelling-claim-counts.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="r-implementation-of-the-assignments-2019-2020.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
